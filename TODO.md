# План работ по реализации Vietnamese Telex

Этот документ описывает пошаговый план для интеграции метода ввода Vietnamese Telex в HeliBoard, основываясь на предоставленной технической спецификации.

## Фаза 1: Создание структуры проекта

**Цель:** Подготовить файловую структуру для новой функциональности.

- [ ] Создать новый пакет: `app/src/main/java/helium314/keyboard/latin/vietnamese/`.
- [ ] Внутри нового пакета создать три пустых файла:
  - [ ] `TelexRules.kt`
  - [ ] `VietnameseUtils.kt`
  - [ ] `TelexProcessor.kt`

## Фаза 2: Реализация слоя данных и утилит

**Цель:** Определить правила и вспомогательные функции, которые не имеют собственной логики состояния.

- [ ] **`TelexRules.kt`**:
  - [ ] Добавить `Map` или `const val` для правил трансформации букв (`aa` → `â`, `dd` → `đ` и т.д.).
  - [ ] Добавить `Map` для правил постановки тонов (`s` → `acute`, `f` → `grave` и т.д.).
  - [ ] Определить символ для отмены тона (например, `z`).

- [ ] **`VietnameseUtils.kt`**:
  - [ ] Реализовать функцию `isVowel(char: Char): Boolean`.
  - [ ] Реализовать функцию `addTone(char: Char, tone: Char): Char` для добавления диакритики к базовой гласной.
  - [ ] Реализовать функцию `removeTone(char: Char): Char` для удаления диакритики.
  - [ ] Реализовать функцию `getVowelIndex(word: String): Int`, определяющую позицию гласной для постановки тона.

## Фаза 3: Реализация основной бизнес-логики

**Цель:** Создать центральный обработчик, который будет применять правила Telex.

- [ ] **`TelexProcessor.kt`**:
  - [ ] Создать основной метод `process(currentWord: String, newKey: Char): String?`.
  - [ ] Реализовать логику для трансформации букв (например, `d` + `d` → `đ`).
  - [ ] Реализовать логику для добавления тонов к последней подходящей гласной.
  - [ ] Реализовать логику "отмены" тона при повторном вводе клавиши тона или при вводе `z`.
  - [ ] Метод должен возвращать `null`, если ни одно из правил не было применено, и измененное слово в противном случае.

## Фаза 4: Интеграция с ядром клавиатуры

**Цель:** "Подключить" `TelexProcessor` к существующему механизму обработки ввода.

- [ ] Найти класс, ответственный за обработку ввода (вероятно, `InputLogic.java` или аналогичный).
- [ ] Найти метод, обрабатывающий ввод символов (например, `onCodeInput` или `sendKey`).
- [ ] Добавить условие для проверки текущей раскладки (например, `if (mSubtype.locale.language == "vi")`).
- [ ] Внутри условия:
    - [ ] Получить текущий набираемый текст (`composing text`).
    - [ ] Вызвать `TelexProcessor.process()`.
    - [ ] Если результат не `null`, обновить `composing text` с помощью `mInputConnection.setComposingText()` и прервать дальнейшую обработку.
    - [ ] Если результат `null`, позволить стандартной логике обработки ввода продолжить выполнение.
- [ ] Убедиться, что логика отключается для полей с паролями (`InputType.TYPE_TEXT_VARIATION_PASSWORD`).

## Фаза 5: Добавление раскладки и пользовательских настроек

**Цель:** Позволить пользователю выбрать вьетнамскую раскладку.

- [ ] Добавить вьетнамский язык (`vi`) в список поддерживаемых языков (вероятно, в `res/xml/method.xml` или аналогичном файле).
- [ ] Создать файл раскладки для вьетнамского языка (например, `qwerty_vi.xml`), который будет использовать стандартную QWERTY-раскладку.
- [ ] Убедиться, что вьетнамскую раскладку можно выбрать в настройках HeliBoard.

## Фаза 6: Тестирование и отладка

**Цель:** Проверить корректность работы новой функциональности.

- [ ] Провести ручное тестирование всех сценариев, описанных в технической спецификации (например, `ma` + `s` → `má`).
- [ ] Протестировать пограничные случаи:
    - [ ] Ввод в начале и в конце слова.
    - [ ] Ввод знаков препинания и цифр после слова с тонами.
    - [ ] Работа с заглавными буквами.
    - [ ] Удаление символов (Backspace).
- [ ] (Опционально) Написать Unit-тесты для `VietnameseUtils` и `TelexProcessor` для автоматической проверки корректности логики.
